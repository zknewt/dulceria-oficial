{% extends 'usuarios/base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block title %}Editar Usuario{% endblock %}

{% block content %}
<div class="container mt-4">

  <div class="card shadow-sm">
    <!-- Header rojo estilo Dulcería -->
    <div class="card-header text-white" style="background-color:#c62828;">
      <div class="d-flex justify-content-between align-items-center">
        <h4 class="mb-0">
          <i class="bi bi-person-gear me-2"></i> Editar Usuario
        </h4>
        <img src="{% static 'img/logo.png' %}" alt="Logo Dulcería Lili" width="40" height="40">
      </div>
    </div>

    <form method="post" novalidate>
      {% csrf_token %}
      <div class="card-body">

        {% if form.non_field_errors %}
          <div class="alert alert-danger mb-3">
            {% for e in form.non_field_errors %}{{ e }}<br>{% endfor %}
          </div>
        {% endif %}

        <!-- Dos columnas en desktop, una en móvil -->
        <div class="row g-3">
          <!-- Columna izquierda -->
          <div class="col-lg-6">
            <div class="mb-2">
              <label class="form-label fw-semibold">Username</label>
              {{ form.username|add_class:"form-control" }}
              {% for e in form.username.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
            </div>

            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label fw-semibold">Nombres</label>
                {{ form.nombres|add_class:"form-control" }}
                {% for e in form.nombres.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold">Apellidos</label>
                {{ form.apellidos|add_class:"form-control" }}
                {% for e in form.apellidos.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
              </div>
            </div>

            <div class="row g-3 mt-1">
              <div class="col-md-6">
                <label class="form-label fw-semibold">Teléfono</label>
                {{ form.telefono|add_class:"form-control" }}
                {% for e in form.telefono.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold">Área / Unidad</label>
                {{ form.area|add_class:"form-control" }}
                {% for e in form.area.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
              </div>
            </div>

            <div class="mt-2">
              <label class="form-label fw-semibold">Observaciones</label>
              {{ form.observaciones|add_class:"form-control" }}
              {% for e in form.observaciones.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
            </div>
          </div>

          <!-- Columna derecha -->
          <div class="col-lg-6">
            <div class="mb-2">
              <label class="form-label fw-semibold">Email</label>
              {{ form.email|add_class:"form-control" }}
              {% for e in form.email.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
            </div>

            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label fw-semibold">Rol</label>
                {{ form.rol|add_class:"form-select" }}
                {% for e in form.rol.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold">Estado</label>
                {{ form.estado|add_class:"form-select" }}
                {% for e in form.estado.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
              </div>
            </div>

            <div class="form-check form-switch mt-3">
              {{ form.mfa_habilitado|add_class:"form-check-input" }}
              <label class="form-check-label fw-semibold ms-1" for="{{ form.mfa_habilitado.id_for_label }}">
                MFA habilitado
              </label>
              {% for e in form.mfa_habilitado.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
            </div>

            <div class="mt-3">
              <label class="form-label fw-semibold">Último acceso</label>
              <input class="form-control" value="{% if form.instance.ultimo_acceso %}{{ form.instance.ultimo_acceso|date:'Y-m-d H:i' }}{% else %}—{% endif %}" readonly>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer con acciones -->
      <div class="card-footer d-flex justify-content-end gap-2">
        <a href="{% url 'usuarios:lista' %}" class="btn btn-outline-secondary">
          <i class="bi bi-arrow-left"></i> Volver
        </a>
        <button type="submit" class="btn btn-danger">
          <i class="bi bi-save"></i> Guardar cambios
        </button>
      </div>
    </form>
  </div>
</div>
{% endblock %}
